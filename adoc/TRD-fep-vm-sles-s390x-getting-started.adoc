:docinfo:

// = {title}
= Installing Fujitsu Enterprise Postgres on SUSE Linux Enterprise Server for IBM Z and LinuxONE - Getting Started

// SLES, FEP, IBM Z and LinuxONE
// :author: Mike Friesenegger
:revnumber: 0.0.1
:toc2:
:toc-title: Installing Fujitsu Enterprise Postgres on SUSE Linux Enterprise Server for IBM Z and LinuxONE - Getting Started

:toclevels: 4

:sles: SUSE Linux Enterprise Server
:fep: Fujitsu Enterprise Postgres
:ibmz: IBM Z and LinuxONE


== Introduction

The enterprise database management system (DBMS) is a fundamental tool of the modern business.  Enterprises of all sizes rely on their DBMS to collect and manage huge volumes of data securely and reliably, all while responding to hundreds or thousands of simultaneous inquiries.

SUSE Linux Enterprise Server is trusted by enterprises around the world for their mission-critical IT deployments. A multimodal operating system that paves the way for IT transformation in the software-defined era. The modern and modular OS helps simplify multimodal IT, makes traditional IT infrastructure efficient and provides an engaging platform for developers. As a result, organiztions can easily deploy and transition business-critical workloads across on-premises and public cloud environments.

Fujitsu has been developing enterprise, mission-critical database systems for over 35 years.  Since 2004, Fujitsu has provided development, support, training, and consulting services to businesses worldwide for PostgreSQL, one of the world's most advanced, open source database systems.  Fujitsu Enterprise Postgres (FEP) remains compatible with open source PostgreSQL, while adding enhanced features, such as in-memory columnar indexing, data masking, transparent data encryption, and dedicated audit logging.

IBM Z and LinuxONE systems are an enterprise-class, purpose-built, data serving platform for business-critical Linux workloads that mandate the highest levels of security, scalability, performance, and resilience. The platform supports traditional n-tier Linux applications and databases, as well as cloud-ready containerized workloads and microservices, delivering a true, secure, hybrid-cloud platform for organizations of all sizes.


== High-level overview

This document guides a administrator through installation of Fujitsu Enterprise Postgres (FEP) 12 on a SUSE Linux Enterprise Server (SLES) 12 SP5, leveraging automation to reduce the time required to deploy both SLES and FEP.
It is written using SLES on s390x (IBM Z and LinuxONE) as a KVM virtual machine.
But these steps can be applied to the installation of FEP on SLES for any supported architecture (x86_64, ppc64le, and s390x), whether on physical hardware or in a virtual machine.

The end result of following these steps is FEP running on SLES with a test database.


This document describes the following:

* Benefits of FEP with SLES on IBM Z or LinuxONE.
* Prerequisites.
* Creation of the hypervisor host.
* AutoYaST preparation to install the virtual machine.
* Configuration of the virtual machine.
* Installation of FEP.
* Verification by creating a test database with FEP WebAdmin.


== Benefits of FEP with SLES on IBM Z or LinuxONE

Starting with the hardware, IBM Z and LinuxONE systems are ideal platforms for sensitive data and critical applications.  Several built-in hardware features help to protect data at rest and in-flight from internal and external threats.

SUSE Linux Enterprise Server for IBM Z and LinuxONE delivers the open source components that surface the hardware capabilities and bring key open source technologies to the platform.  For example, Kernel-based Virtual Machine (KVM) is an open source virtualization technology included in SLES for IBM Z and LinuxONE.  Some of the benefits of KVM include:

* It is a mature, virtualization technology - part of the Linux kernel since 2007.
* It is available across platforms, enabling the use of the same tooling on x86, S/390, POWER, ARM, and so on.
* It is kernel-level, yielding performance advantages.
* It is well-known, allowing you to take advantage of existing skills and familiar tooling, like virsh.


Combining IBM Z and LinuxONE with SLES and Fujitsu Enterprise Postgres (FEP), delivers a highly secure, agile data platform for mission-critical applications and enables organizations to create full DevOps pipelines with secure, virtual environments for development, testing, quality assurance, and, of course, production.



== Prerequisites

The following environment is used for this document (your environment might be different):

* IBM Z KVM host running in an LPAR:
** Four IBM Integrated Facility for Linux (IFL) processors
** 12 GB storage (RAM)
** Two Fibre Channel Protocol (FCP) adapters for multipath
** Four 25 GB Small Computer System Interface (SCSI) Logical Unit Number (LUN):
*** One LUN is used for the KVM host operating system
*** Three LUNs are used to store the databases, transaction logs and database backups
** One or two Open System Adapters (OSA):
*** OSA 1 (eth0) is for SSH connections to the KVM host and for VEPA-based devices for VMs
*** OSA 2 (eth1) is optional, but can be used for VEPA-based devices for VMs
* A workstation with a web browser and ssh client will be needed.


== Creation of the hypervisor host

The goal is to install a SUSE Linux Enterprise Server (SLES) 15 SP2 KVM hypervisor host in an IBM Z LPAR.  We choose SLES 15 SP2 as a KVM hypervisor because it contains the latest KVM features and has the longest support cycle of the currently supported SLES versions.

Use the guidelines for this installation as described at the SLES https://documentation.suse.com/sles/15-SP2/single-html/SLES-deployment/#cha-zseries[Installation on IBM Z and LinuxONE].

Also, adhere to the following guidelines when you perform the installation:

* (Optional) Enable multipath to the zFCP SCSI LUNs where SLES 15 SP2 is installed.
* Register the system to scc.suse.com or a local SMT/RMT server.
* Apply updates during or after the installation.
* No modules, extensions, or add-on products are needed.
* Select system role “KVM Virtualization Host”, which installs the required Patterns and Packages (for example, virt-install).
* Install the following additional packages:
** iputils
** wget
** less


== AutoYaST preparation to install the virtual machine

The goal of this chapter is to copy a preconfigured autoyast.xml and a prep script that will automate the installation of SLES into a VM.  It is important to review and edit the prep script that will be used to prepare the VM for the SLES 12 SP5 install.

Complete the following steps to install a SLES KVM VM:

. Download SLE-12-SP5-Server-DVD-s390x-GM-DVD1.iso from SUSE.com and copy to /var/lib/libvirt/images/isos on the KVM host.
. Copy the fep-autoyast.xml file that is available in Appendix A to /root/fep-autoyast.xml on the KVM host.
. Copy the script prep-for-fep-vm-install.sh that is available in Appendix B to /root/bin on the KVM host.
. Run the chmod +x /root/bin/prep-for-fep-vm-install.sh command.
. Edit the /root/bin/prep-for-fep-vm-install.sh file and modify the variables to match your environment.
. Run the prep-for-fep-vm-install.sh script.

NOTE:  If this script must be run again, remove the fep VM runtime definition by
using the *virsh undefine fep* command.

AutoYAST is used to install the SLES KVM VM. Running the prep-for-fep-install.sh script
creates an ISO file that contains the AutoYaST configuration. It also creates the XML files with
the configuration described below which is used to install and run the KVM VM.

* 4 virtual CPUs
* 4GB RAM (the minimum requirement is 2GB of RAM)
* Virtual NIC connected to an OSA device on KVM host
* One QCOW2 file used for the OS installation
** /var/lib/libvirt/images/fep_os.qcow2 (vda)
* Three physical SCSI LUNs. The multipathed devives below are examples used throughout this chapter:
** /dev/mapper/36005076307ffd3b3000000000000013e used for FEP databases (vdb)
** /dev/mapper/36005076307ffd3b3000000000000013f for FEP transaction logs (vdc)
** /dev/mapper/36005076307ffd3b30000000000000140 for FEP DB backups (vdd)
* The installation media is an ISO on the KVM host:
** /var/lib/libvirt/images/isos/SLE-12-SP5-Server-DVD-s390x-GM-DVD1.iso


== Configuration of the virtual machine

The goal of this chapter is to successfully install SLES 12 SP5.  To accomplish this the VM is started and the autoyast installation begins automatically.

Complete the following steps to install and configure the SLES 12 SP5 KVM guest:

1. Boot the new virtual server to start the automated installation by running the following command:

 virsh create /root/fep_install.xml --console

The automated installation is configured to stop at the "Installation Settings" for a final inspection of the configuration before the installation begins.  Press *Alt-I* to begin the installation.

The following options are configured during the automated installation (for more information, review the fep-autoyast.xml file):

* vda (25 GB):
** vda1:
*** Size: 200 MB
*** Directory: /boot/zipl
*** Filesystem: ext2
** vda2:
*** Size: 4 GB
*** Directory: swap
** vda3:
*** Size: Remainder of the disk
*** Directory: /
*** Filesystem: btrfs

* vdb (25 GB):
** vdb1:
*** Size: Full disk partition
*** Directory: /database
*** Filesystem: xfs

* vdc (25 GB):
** vdc1:
*** Size: Full disk partition
*** Directory: /dbtranslg
*** Filesystem: xfs

* vdd (25 GB):
** vdd1:
*** Size: Full disk partition
*** Directory: /dbbackup
*** Filesystem: xfs

* eth0: none
* Patterns:
** Help and support documentation
** Base system
** Minimal system (appliances)
** YaST2 configuration packages

* Packages (required by FEP):
** dstat
** libmemcached
** openCryptoki
** python3
** sysstat
** java-1_8_0-openjdk

* Initial root user password is set to *password*

* Creation of a fsepuser as the DB administrator with password set to *password*


2. Restart the virtual server by using the following command to complete phase 2 of the automated installation:

 virsh start fep --console


NOTE: You can safely ignore any postfix warnings or errors that appear in the console.


3. Use YaST to configure the host name, static IP address, and other networking information for the VM.

4. Log out and press *Ctrl+]* (Ctrl key plus the right square bracket) to disconnect from the console.

5. Use SSH to connect to the system and complete the remaining steps.

6. Apply all available SLES updates by running the following command:

 zypper patch

This command should be run twice. The first run updates the zypper stack and the second run applies all available updates.

NOTE: Be sure that SLES is registered to the SUSE Customer Center (SCC), a local
Subscription Management Tool (SMT), or local Repository Mirroring Tool (RMT) server.



== Installation of FEP

The goal of this chapter is to successfully install FEP.  The FEP 12 installation iso will be mounted, the FEP 12 RPM installed and the setup utility for WebAdmin run.

Complete the following steps to install the FEP RPM packages and enable FEP WebAdmin.  Refer to the https://www.postgresql.fastware.com/resources-fujitsu-enterprise-postgres-optimised-for-ibm-linuxone[Resources - FUJITSU Enterprise Postgres 12 on IBM LinuxONE™] page for detailed installation and configuration instructions.

. Copy the FEP installation ISO to /root
. Mount the FEP installation ISO to /mnt

  mount /root/fsep12_ae_linux64.iso /mnt

. Use zypper to install the FEP server and WebAdmin

 zypper in /mnt/SERVER/Linux/packages/SUSE12s390x/FJSVfsep-SV-12-1200-0.s390x.rpm \
 /mnt/WEBADMIN/Linux/packages/SUSE12s390x/FJSVfsep-WAD-12-1200-0.s390x.rpm

NOTE: Ignore the "Signature verification failed" warning because the packages are not signed.

. Change to /opt/fsepv<x>webadmin/sbin and execute WebAdminSetup

 cd /opt/fsepv12webadmin/sbin
 ./WebAdminSetup

. Accept the default port numbers for the:
  * Web Server (27515)
  * Internal port number for WebAdmin (27516)
. Answer "yes" for WebAdmin autostart
  * NOTE: The systemctl service name for FEP 12 is FSEPWAD_120_WA_64.service

== Verification by creating a test database with FEP WebAdmin

Complete the following steps to create a test database to confirm that FEP has been installed and running correctly.

. Open a web browser
. Go to the hostname or IP address and port number of the FEP WebAdmin server
 http://<hostname or IP address>:27515
. Select "Launch WebAdmin"
. Use *fsepuser* to authenticate
  * NOTE: The default password is *password*
. Click the "+" symbol to create a database
. Use the information below to complete the fields
  * Configuration type: Standalone configuration
  * Server product type: FUJITSU Enterprise Postgres 12
  * Location: Local
  * Instance name: dbtest
  * Instance port: 27600
  * Data storage path: /database/dbtest
  * Backup: Enabled
  * Backup storage path: /dbbackup/dbtest
  * Transaction log path: /dbtranslg/dbtest
  * Encoding: UTF8
  * WAL file size (MB): <leave blank>
. Click the check-mark icon to create the database
. Click "Close" when the database instance has been created sucessfully
. If you see the screen below then you have successfully created your first FEP database!

image::fep-s390x-dbtest-created.png[Successfully created test database,scaledwidth="100%", align="center"]

== Summary

This getting started guide has been an introduction to deploying Fujitsu Enterprise Postgres on SUSE Linux Enterprise Server using KVM virtual machines on an IBM Z or LinuxONE system.  Automation has been used to simplify the deployment of SLES in a KVM virtual machine althogh this can be done manually.

== Additional resources

For more information, visit:

*	Data serving with Fujitsu Enterprise Postgres 12 on LinuxONE (currently draft IBM Redbooks publication)[https://www.redbooks.ibm.com/redpieces/abstracts/sg248499.html?Open]

== Appendix A

fep-autoyast.xml

....
<?xml version="1.0"?>
<!DOCTYPE profile>
<profile xmlns="http://www.suse.com/1.0/yast2ns" xmlns:config="http://www.suse.com/1.0/configns">
  <add-on>
    <add_on_products config:type="list"/>
  </add-on>
  <dasd>
    <devices config:type="list"/>
    <format_unformatted config:type="boolean">false</format_unformatted>
  </dasd>
  <deploy_image>
    <image_installation config:type="boolean">false</image_installation>
  </deploy_image>
  <firewall>
    <enable_firewall config:type="boolean">false</enable_firewall>
    <start_firewall config:type="boolean">false</start_firewall>
  </firewall>
  <general>
    <ask-list config:type="list"/>
    <cio_ignore config:type="boolean">false</cio_ignore>
    <mode>
      <confirm config:type="boolean">true</confirm>
    </mode>
    <proposals config:type="list"/>
    <signature-handling>
      <accept_file_without_checksum config:type="boolean">true</accept_file_without_checksum>
      <accept_non_trusted_gpg_key config:type="boolean">true</accept_non_trusted_gpg_key>
      <accept_unknown_gpg_key config:type="boolean">true</accept_unknown_gpg_key>
      <accept_unsigned_file config:type="boolean">true</accept_unsigned_file>
      <accept_verification_failed config:type="boolean">false</accept_verification_failed>
      <import_gpg_key config:type="boolean">true</import_gpg_key>
    </signature-handling>
    <storage>
      <partition_alignment config:type="symbol">align_optimal</partition_alignment>
      <start_multipath config:type="boolean">false</start_multipath>
    </storage>
  </general>
  <kdump>
    <add_crash_kernel config:type="boolean">true</add_crash_kernel>
    <crash_kernel>163M</crash_kernel>
  </kdump>
  <language>
    <language>en_US</language>
    <languages/>
  </language>
  <login_settings/>
  <networking>
    <dns>
      <dhcp_hostname config:type="boolean">false</dhcp_hostname>
      <write_hostname config:type="boolean">false</write_hostname>
    </dns>
    <ipv6 config:type="boolean">false</ipv6>
    <keep_install_network config:type="boolean">true</keep_install_network>
    <managed config:type="boolean">false</managed>
    <interfaces config:type="list">
      <interface>
        <bootproto>none</bootproto>
        <device>eth0</device>
        <dhclient_set_default_route>yes</dhclient_set_default_route>
        <name>Ethernet Card 0 (virtio4)</name>
        <startmode>auto</startmode>
      </interface>
  </interfaces>
  </networking>
  <nis>
    <start_autofs config:type="boolean">false</start_autofs>
    <start_nis config:type="boolean">false</start_nis>
  </nis>
  <ntp-client>
    <start_at_boot config:type="boolean">false</start_at_boot>
    <start_in_chroot config:type="boolean">false</start_in_chroot>
    <sync_interval config:type="integer">5</sync_interval>
    <synchronize_time config:type="boolean">false</synchronize_time>
  </ntp-client>
  <partitioning config:type="list">
    <drive>
      <device>/dev/vda</device>
      <disklabel>msdos</disklabel>
      <enable_snapshots config:type="boolean">true</enable_snapshots>
      <initialize config:type="boolean">true</initialize>
      <partitions config:type="list">
        <partition>
          <create config:type="boolean">true</create>
          <crypt_fs config:type="boolean">false</crypt_fs>
          <filesystem config:type="symbol">ext2</filesystem>
          <format config:type="boolean">true</format>
          <fstopt>acl,user_xattr</fstopt>
          <loop_fs config:type="boolean">false</loop_fs>
          <mount>/boot/zipl</mount>
          <mountby config:type="symbol">uuid</mountby>
          <partition_id config:type="integer">131</partition_id>
          <partition_nr config:type="integer">1</partition_nr>
          <partition_type>primary</partition_type>
          <resize config:type="boolean">false</resize>
          <size>auto</size>
        </partition>
        <partition>
          <create config:type="boolean">true</create>
          <crypt_fs config:type="boolean">false</crypt_fs>
          <filesystem config:type="symbol">swap</filesystem>
          <format config:type="boolean">true</format>
          <fstopt>defaults</fstopt>
          <loop_fs config:type="boolean">false</loop_fs>
          <mount>swap</mount>
          <mountby config:type="symbol">uuid</mountby>
          <partition_id config:type="integer">130</partition_id>
          <partition_nr config:type="integer">2</partition_nr>
          <resize config:type="boolean">false</resize>
          <!-- Minimum of 4G of swap required for Oracle 19c installation -->
          <size>4G</size>
        </partition>
        <partition>
          <create config:type="boolean">true</create>
          <crypt_fs config:type="boolean">false</crypt_fs>
          <filesystem config:type="symbol">btrfs</filesystem>
          <format config:type="boolean">true</format>
          <fstopt>defaults</fstopt>
          <loop_fs config:type="boolean">false</loop_fs>
          <mount>/</mount>
          <mountby config:type="symbol">uuid</mountby>
          <partition_id config:type="integer">131</partition_id>
          <partition_nr config:type="integer">3</partition_nr>
          <partition_type>primary</partition_type>
          <resize config:type="boolean">false</resize>
          <size>max</size>
        </partition>
      </partitions>
      <pesize/>
      <type config:type="symbol">CT_DISK</type>
      <use>all</use>
    </drive>
    <drive>
      <device>/dev/vdb</device>
      <disklabel>msdos</disklabel>
      <enable_snapshots config:type="boolean">false</enable_snapshots>
      <initialize config:type="boolean">true</initialize>
      <partitions config:type="list">
        <partition>
          <create config:type="boolean">true</create>
          <crypt_fs config:type="boolean">false</crypt_fs>
          <filesystem config:type="symbol">xfs</filesystem>
          <format config:type="boolean">true</format>
          <fstopt>defaults</fstopt>
          <loop_fs config:type="boolean">false</loop_fs>
          <mount>/database</mount>
          <mountby config:type="symbol">uuid</mountby>
          <partition_id config:type="integer">131</partition_id>
          <partition_nr config:type="integer">1</partition_nr>
          <partition_type>primary</partition_type>
          <resize config:type="boolean">false</resize>
          <size>max</size>
        </partition>
      </partitions>
      <pesize/>
      <type config:type="symbol">CT_DISK</type>
      <use>all</use>
    </drive>
    <drive>
      <device>/dev/vdc</device>
      <disklabel>msdos</disklabel>
      <enable_snapshots config:type="boolean">false</enable_snapshots>
      <initialize config:type="boolean">true</initialize>
      <partitions config:type="list">
        <partition>
          <create config:type="boolean">true</create>
          <crypt_fs config:type="boolean">false</crypt_fs>
          <filesystem config:type="symbol">xfs</filesystem>
          <format config:type="boolean">true</format>
          <fstopt>defaults</fstopt>
          <loop_fs config:type="boolean">false</loop_fs>
          <mount>/translog</mount>
          <mountby config:type="symbol">uuid</mountby>
          <partition_id config:type="integer">131</partition_id>
          <partition_nr config:type="integer">1</partition_nr>
          <partition_type>primary</partition_type>
          <resize config:type="boolean">false</resize>
          <size>max</size>
        </partition>
      </partitions>
      <pesize/>
      <type config:type="symbol">CT_DISK</type>
      <use>all</use>
    </drive>
    <drive>
      <device>/dev/vdc</device>
      <disklabel>msdos</disklabel>
      <enable_snapshots config:type="boolean">false</enable_snapshots>
      <initialize config:type="boolean">true</initialize>
      <partitions config:type="list">
        <partition>
          <create config:type="boolean">true</create>
          <crypt_fs config:type="boolean">false</crypt_fs>
          <filesystem config:type="symbol">xfs</filesystem>
          <format config:type="boolean">true</format>
          <fstopt>defaults</fstopt>
          <loop_fs config:type="boolean">false</loop_fs>
          <mount>/dbtranslg</mount>
          <mountby config:type="symbol">uuid</mountby>
          <partition_id config:type="integer">131</partition_id>
          <partition_nr config:type="integer">1</partition_nr>
          <partition_type>primary</partition_type>
          <resize config:type="boolean">false</resize>
          <size>max</size>
        </partition>
      </partitions>
      <pesize/>
      <type config:type="symbol">CT_DISK</type>
      <use>all</use>
    </drive>
    <drive>
      <device>/dev/vdd</device>
      <disklabel>msdos</disklabel>
      <enable_snapshots config:type="boolean">false</enable_snapshots>
      <initialize config:type="boolean">true</initialize>
      <partitions config:type="list">
        <partition>
          <create config:type="boolean">true</create>
          <crypt_fs config:type="boolean">false</crypt_fs>
          <filesystem config:type="symbol">xfs</filesystem>
          <format config:type="boolean">true</format>
          <fstopt>defaults</fstopt>
          <loop_fs config:type="boolean">false</loop_fs>
          <mount>/dbbackup</mount>
          <mountby config:type="symbol">uuid</mountby>
          <partition_id config:type="integer">131</partition_id>
          <partition_nr config:type="integer">1</partition_nr>
          <partition_type>primary</partition_type>
          <resize config:type="boolean">false</resize>
          <size>max</size>
        </partition>
      </partitions>
      <pesize/>
      <type config:type="symbol">CT_DISK</type>
      <use>all</use>
    </drive>
  </partitioning>
  <report>
    <errors>
      <log config:type="boolean">true</log>
      <show config:type="boolean">true</show>
      <timeout config:type="integer">0</timeout>
    </errors>
    <messages>
      <log config:type="boolean">true</log>
      <show config:type="boolean">true</show>
      <timeout config:type="integer">0</timeout>
    </messages>
    <warnings>
      <log config:type="boolean">true</log>
      <show config:type="boolean">true</show>
      <timeout config:type="integer">0</timeout>
    </warnings>
    <yesno_messages>
      <log config:type="boolean">true</log>
      <show config:type="boolean">true</show>
      <timeout config:type="integer">0</timeout>
    </yesno_messages>
  </report>
  <services-manager>
    <default_target>multi-user</default_target>
  </services-manager>
  <software>
    <image/>
    <install_recommended config:type="boolean">true</install_recommended>
    <instsource/>
    <packages config:type="list">
      <package>vlan</package>
      <package>snapper</package>
      <package>sles-release</package>
      <package>openssh</package>
      <package>lvm2</package>
      <package>kexec-tools</package>
      <package>kdump</package>
      <package>grub2</package>
      <package>glibc</package>
      <package>e2fsprogs</package>
      <package>btrfsprogs</package>
      <!-- Required by FEP install -->
      <package>dstat</package>
      <package>libmemcached</package>
      <package>openCryptoki</package>
      <package>python3</package>
      <package>sysstat</package>
      <package>java-1_8_0-openjdk</package>
    </packages>
    <patterns config:type="list">
      <pattern>Minimal</pattern>
      <pattern>base</pattern>
      <pattern>documentation</pattern>
      <pattern>yast2</pattern>
    </patterns>
  </software>
  <timezone>
    <hwclock>UTC</hwclock>
    <timezone>America/New_York</timezone>
  </timezone>
  <users config:type="list">
    <user>
      <fullname>root</fullname>
      <gid>0</gid>
      <home>/root</home>
      <password_settings>
        <expire/>
        <flag/>
        <inact/>
        <max/>
        <min/>
        <warn/>
      </password_settings>
      <shell>/bin/bash</shell>
      <uid>0</uid>
      <user_password>password</user_password>
      <username>root</username>
    </user>
    <user>
      <fullname>fsepuser</fullname>
      <password_settings>
        <expire/>
        <flag/>
        <inact/>
        <max/>
        <min/>
        <warn/>
      </password_settings>
      <shell>/bin/bash</shell>
      <user_password>password</user_password>
      <username>fsepuser</username>
    </user>
  </users>
  <zfcp>
    <devices config:type="list"/>
  </zfcp>
  <scripts>
    <init-scripts config:type="list">
      <script>
        <filename>01-init.sh</filename>
        <interpreter>shell</interpreter>
        <source><![CDATA[
#!/bin/sh

echo "Running Init script - 01-init.sh"
chown -R fsepuser /database
chown -R fsepuser /dbtranslg
chown -R fsepuser /dbbackup
chown
]]>
        </source>
      </script>
    </init-scripts>
  </scripts>
</profile>
....

== Appendix B

prep-for-fep-vm-install.sh

....
#!/bin/bash

# KVM Host variables
AUTOYAST_FILE=/root/fep-autoyast.xml
ISO_FILE=/var/lib/libvirt/images/isos/SLE-12-SP5-Server-DVD-s390x-GM-DVD1.iso
INSTALL_DIR=/var/lib/libvirt/images/sles12sp5-install

# FEP VM variables
VM_OS_QCOW2=/var/lib/libvirt/images/fep_os.qcow2
VM_OS_QCOW2_SIZE=25G
VM_FEPDB_SCSI=/dev/mapper/36005076307ffd3b3000000000000013e
VM_FEPTRANS_SCSI=/dev/mapper/36005076307ffd3b3000000000000013f
VM_FEPBU_SCSI=/dev/mapper/36005076307ffd3b30000000000000140
VEPA_NIC=eth1
VEPA_NIC_DEVNO=0x0810

if test ! -e ${ISO_FILE}; then
    echo
    echo "Please copy $(basename ${ISO_FILE}) to $(dirname ${ISO_FILE})."
    echo "Quitting..."
    exit 1
fi
if test ! -e ${AUTOYAST_FILE}; then
    echo
    echo "Please copy $(basename ${AUTOYAST_FILE}) to $(dirname ${AUTOYAST_FILE})."
    echo "Quitting..."
    exit 1
fi

if test -e ${VM_OS_QCOW2} -o -e /var/lib/libvirt/images/sles12sp5-install -o -e /root/fep_install.xml; then
   echo "Cleaning up a previous FEP VM installation attempt."
   rm -rf ${VM_OS_QCOW2} /var/lib/libvirt/images/sles12sp5-install /root/fep_install.xml
   virsh undefine fep >/dev/null 2>&1
fi

echo "Setting up environment for autoyast installation."
mkdir -p ${INSTALL_DIR}
TMP_MNT=$(mktemp -d)
mount ${ISO_FILE} ${TMP_MNT} > /dev/null 2>&1
cp ${TMP_MNT}/boot/s390x/linux ${INSTALL_DIR}
cp ${TMP_MNT}/boot/s390x/initrd ${INSTALL_DIR}
cp ${AUTOYAST_FILE} ${INSTALL_DIR}/autoyast.xml
umount ${TMP_MNT}
rmdir ${TMP_MNT}
mkisofs -quiet ${INSTALL_DIR}/autoyast.xml > ${INSTALL_DIR}/autoyast.iso

echo "Creating FEP OS qcow2 virtual disk file."
if type -p qemu-img > /dev/null 2>&1; then
    qemu-img create -q -f qcow2 ${VM_OS_QCOW2} ${VM_OS_QCOW2_SIZE}
else
    echo
    echo "Unable to find qemu-img."
    echo "Quitting..."
    exit 1
fi

echo "Generating FEP virtual machine xml file for SLES installation."
for disk in ${VM_OS_QCOW2} ${VM_FEBDB_SCSI} ${VM_FEPTRANS_SCSI}; do
    if test ! -e ${disk}; then
        echo
        echo "${disk} is not defined."
        echo "Quitting..."
        exit 1
    fi
done
if test $(lsqeth | grep -c ${VEPA_NIC}) -eq 0; then
    echo
    echo "${VEPA_NIC} is not defined."
    echo "Quitting..."
    exit 1
fi
virt-install --name fep --vcpus 4 --memory 4096 \
--disk path=${VM_OS_QCOW2},target=vda \
--disk path=${VM_FEPDB_SCSI},cache=none,io=native,target=vdb \
--disk path=${VM_FEPTRANS_SCSI},cache=none,io=native,target=vdc \
--disk path=${VM_FEPBU_SCSI},cache=none,io=native,target=vdd \
--network type=direct,source=${VEPA_NIC},address.type=ccw,address.cssid=0xfe,address.ssid=0x0,address.devno=${VEPA_NIC_DEVNO} \
--cdrom ${ISO_FILE} \
--disk path=${INSTALL_DIR}/autoyast.iso,device=cdrom \
--boot kernel=${INSTALL_DIR}/linux,initrd=${INSTALL_DIR}/initrd,\
kernel_args="self_update=0 install=cd:/ autoyast=device://sr1/autoyast.xml" \
--print-xml 1 > /root/fep_install.xml

echo "Defining FEP virtual machine for runtime administration."
virsh -q define /root/fep_install.xml
virt-xml -q fep --remove-device --disk path=${INSTALL_DIR}/autoyast.iso,device=cdrom
virt-xml -q fep --edit --boot kernel=,initrd=,kernel_args=
virt-xml -q fep --edit --events on_reboot=restart

exit 0
....

++++
<?pdfpagebreak?>
++++

:leveloffset: 0
// Standard SUSE Best Practices includes
== Legal notice
include::common_sbp_legal_notice.adoc[]

++++
<?pdfpagebreak?>
++++

// Standard SUSE Best Practices includes
// include::common_gfdl1.2_i.adoc[]

:leveloffset: 0
include::common_gfdl1.2_i.adoc[]

//end
